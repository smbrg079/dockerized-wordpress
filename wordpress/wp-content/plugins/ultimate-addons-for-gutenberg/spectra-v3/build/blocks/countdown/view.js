import*as e from"@wordpress/interactivity";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const s=(r={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},i={},t.d(i,r),i),n=864e5,o=36e5,a=(e,t,s,n)=>({...e&&{days:0},...t&&{hours:0},...s&&{minutes:0},...n&&{seconds:0},isExpired:!0});var r,i;const l=new class{constructor(){this.countdowns=new Map,this.intervalId=null,this.intervalDuration=1e3,this.rafId=null}register(e,t){const{element:s,endDateTime:n,showDays:o,showHours:a,showMinutes:r,showSeconds:i,labels:l,onExpired:u}=t;return this.countdowns.set(e,{element:s,endDateTime:n,showDays:o,showHours:a,showMinutes:r,showSeconds:i,labels:l,onExpired:u,lastValues:null}),this.updateIntervalDuration(),1===this.countdowns.size&&this.start(),()=>this.unregister(e)}unregister(e){this.countdowns.delete(e),0===this.countdowns.size?this.stop():this.updateIntervalDuration()}updateIntervalDuration(){let e=864e5;for(const[,n]of this.countdowns){const o=(n.showDays,t=n.showHours,s=n.showMinutes,n.showSeconds?1e3:s?6e4:t?36e5:864e5);o<e&&(e=o)}var t,s;e=Math.min(e,1e3),e!==this.intervalDuration&&this.intervalId?(this.intervalDuration=e,this.stop(),this.start()):this.intervalDuration=e}start(){this.intervalId||(this.tick(),this.intervalId=setInterval((()=>this.tick()),this.intervalDuration))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}tick(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame((()=>{const e=(new Date).getTime(),t=[];for(const[s,n]of this.countdowns)try{const o=new Date(n.endDateTime).getTime()-e;if(o<0)t.push(s),this.updateCountdownDOM(n,{days:0,hours:0,minutes:0,seconds:0}),n.onExpired&&n.onExpired();else{const e=this.calculateTime(o,n);this.hasValuesChanged(n.lastValues,e)&&(this.updateCountdownDOM(n,e),n.lastValues=e)}}catch(e){}t.forEach((e=>this.unregister(e)))}))}calculateTime(e,t){const{showDays:s,showHours:n,showMinutes:o,showSeconds:a}=t;let r=e;const i={days:0,hours:0,minutes:0,seconds:0};return s&&(i.days=Math.floor(r/864e5),r%=864e5),n&&(i.hours=Math.floor(r/36e5),r%=36e5),o&&(i.minutes=Math.floor(r/6e4),r%=6e4),a&&(i.seconds=Math.floor(r/1e3)),i}hasValuesChanged(e,t){return!e||e.days!==t.days||e.hours!==t.hours||e.minutes!==t.minutes||e.seconds!==t.seconds}updateCountdownDOM(e,t){const{element:s,labels:n}=e;[{type:"day",value:t.days,label:1===t.days?n.dayLabel:n.daysLabel},{type:"hour",value:t.hours,label:1===t.hours?n.hourLabel:n.hoursLabel},{type:"minute",value:t.minutes,label:1===t.minutes?n.minuteLabel:n.minutesLabel},{type:"second",value:t.seconds,label:1===t.seconds?n.secondLabel:n.secondsLabel}].forEach((e=>{const t=`.wp-block-spectra-countdown-child-${e.type}`,n=s.querySelector(t);if(!n)return;const o=String(e.value).padStart(2,"0"),a=n.querySelector(".wp-block-spectra-countdown-child-number");a&&a.textContent!==o&&(a.textContent=o);const r=n.querySelector(".wp-block-spectra-countdown-child-label");r&&r.textContent!==e.label&&(r.textContent=e.label)}))}};"undefined"!=typeof window&&(window.spectraFrontendCountdownTimerManager=l);const u=l;(0,s.store)("spectra/countdown",{callbacks:{initialize:()=>{const e=(0,s.getContext)(),{endDateTime:t,showDays:r,showHours:i,showMinutes:l,showSeconds:d,labels:c,timerType:h="date"}=e,{ref:w}=(0,s.getElement)(),b=new CustomEvent("spectra:countdown:initialized",{detail:{context:e},bubbles:!0});if(w.dispatchEvent(b),"date"!==h)return;if(!t||isNaN(new Date(t).getTime()))return;const p=`countdown-${w.getAttribute("data-wp-key")||Math.random().toString(36).substr(2,9)}`;e.unregister&&e.unregister();const m=((e,t)=>({days:e.days,hours:e.hours,minutes:e.minutes,seconds:e.seconds,isExpired:e.isExpired,daysLabel:1===e.days?t.dayLabel:t.daysLabel,hoursLabel:1===e.hours?t.hourLabel:t.hoursLabel,minutesLabel:1===e.minutes?t.minuteLabel:t.minutesLabel,secondsLabel:1===e.seconds?t.secondLabel:t.secondsLabel}))(((e,t=!0,s=!0,r=!0,i=!0)=>{const l=new Date(e);if(isNaN(l.getTime()))return a(t,s,r,i);const u=Date.now(),d=l.getTime()-u;return d<=0?a(t,s,r,i):((e,t,s,a,r)=>{const i={};let l=e;return t&&(i.days=Math.floor(l/n),l%=n),s&&(i.hours=Math.floor(l/o),l%=o),a&&(i.minutes=Math.floor(l/6e4),l%=6e4),r&&(i.seconds=Math.floor(l/1e3)),{...i,isExpired:!1}})(d,t,s,r,i)})(t,r,i,l,d),c);e.countdown=m,((e,t)=>{[{type:"day",value:"days",label:"daysLabel"},{type:"hour",value:"hours",label:"hoursLabel"},{type:"minute",value:"minutes",label:"minutesLabel"},{type:"second",value:"seconds",label:"secondsLabel"}].forEach((s=>{const n=`.wp-block-spectra-countdown-child-${s.type}`,o=e.querySelector(n);if(!o)return;const a=t[s.value]||0,r=String(a).padStart(2,"0"),i=o.querySelector(".wp-block-spectra-countdown-child-number");i&&i?.textContent!==r&&(i.textContent=r);const l=t[s.label],u=o.querySelector(".wp-block-spectra-countdown-child-label");u&&u?.textContent!==l&&(u.textContent=l)}))})(w,m),e.unregister=u.register(p,{element:w,endDateTime:t,showDays:r,showHours:i,showMinutes:l,showSeconds:d,labels:c,onExpired:()=>{const t=new CustomEvent("spectra:countdown:expired",{detail:{context:e},bubbles:!0});w.dispatchEvent(t)}});const y=new MutationObserver((t=>{for(const s of t)for(const t of s.removedNodes)if(t===w||t.contains(w))return e.unregister&&e.unregister(),void y.disconnect()}));y.observe(document.body,{childList:!0,subtree:!0})}}});